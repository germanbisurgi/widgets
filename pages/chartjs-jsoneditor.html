<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chart.js + JSONEditor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-xs-12 col-md-8">
            <div id="json-editor-form"></div>
            <div class="form-group">
                <label for="json-editor-value">Small textarea</label>
                <textarea class="form-control rounded-0" id="json-editor-value" rows="50"></textarea>
            </div>
        </div>
        <div class="col-xs-12 col-md-4">
            <canvas id="myChart" width="400" height="400"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.1.1/chart.js" integrity="sha512-aWx9jeVTj8X49UzUnUHGIlo6rNne1xNsCny/lL0QwUTQK2eilrHXpSk9xbRm4FJ4eLi2XBmnFlRkWPoChSx8bA==" crossorigin="anonymous"></script>
<script>
    window.addEventListener('load', function () {

      // ----------------------------------------------------------- json-editor

      var startval = {
        type: 'line',
        data: {
          datasets: [
            {
              label: 'Chrome',
              backgroundColor: '#0080ff',
              borderColor: '#0080ff',
              color: '#0080ff',
              data: [
                {x: 'A', y: 115},
                {x: 'B', y: 99},
                {x: 'C', y: 20},
                {x: 'D', y: 56},
                {x: 'E', y: 45},
                {x: 'F', y: 87},
                {x: 'G', y: 12},
              ]
            },
            {
              label: 'Firefox',
              backgroundColor: '#ff9400',
              borderColor: '#ff9400',
              color: '#ff9400',
              data: [
                {x: 'A', y: 90},
                {x: 'B', y: 80},
                {x: 'C', y: 44},
                {x: 'D', y: 25},
                {x: 'E', y: 70},
                {x: 'F', y: 36},
                {x: 'G', y: 56},
              ]
            }
          ]
        }
      }

      var defaultSchema = {
        'title': 'ChartJs',
        'type': 'object',
        'properties': {
          'type': {
            'type': 'string',
            'title': 'Chart type',
            'default': 'bar',
            'enum': [
              'bar',
              'line',
              // 'bubble',
              // 'doughnut',
              // 'polarArea',
              // 'radar',
              // 'scatter',
            ],
            'options': {
              'enum_titles': [
                'Bar Chart',
                'Line Chart',
              ]
            }
          },
          'data': {
            'title': 'Data',
            'type': 'object',
            'properties': {
              'datasets': {
                'type': 'array',
                'format': 'tabs',
                'title': 'Datasets',
                'items': {
                  'type': 'object',
                  'headerTemplate': '{{ self.label }}',
                  'description': 'A dataset is a structured collection of data generally associated with a unique body of work.',
                  'properties': {
                    'label': {
                      'type': 'string',
                      'title': 'Dataset label',
                      'default': 'My dataset label',
                    },
                    'data': {
                      'type': 'array',
                      'format': 'tabs',
                      'title': 'Dataset Data',
                      'description': 'Data are observations or measurements (unprocessed or processed) represented as text, numbers, or multimedia.',
                      'items': {
                        'type': 'object',
                        'headerTemplate': '{{ self.x }}',
                        'properties': {
                          'x': {
                            'type': 'string',
                            'title': 'X',
                          },
                          'y': {
                            'type': 'integer',
                            "title": "Y"
                          }
                        }
                      }
                    },
                    'backgroundColor': {
                      'type': 'string',
                      'title': 'Background color',
                      'default': '#158e66',
                      'description': 'Background color in Hexadecimal, RGB, or HSL',
                    },
                    'borderColor': {
                      'type': 'string',
                      'title': 'Background color',
                      'default': '#158e66',
                      'description': 'Border color in Hexadecimal, RGB, or HSL',
                    },
                    'color': {
                      'type': 'string',
                      'title': 'Background color',
                      'default': '#158e66',
                      'description': 'Font color in Hexadecimal, RGB, or HSL',
                    }
                  }
                }
              }
            }
          }
        }
      }

      var defaultOptions = {
        iconlib: 'fontawesome5',
        object_layout: 'normal',
        schema: defaultSchema,
        show_errors: 'interaction',
        theme: 'bootstrap4',
        required_by_default: true,
        disable_collapse: true,
        disable_edit_json: true,
        disable_properties: true,
        remove_button_labels: true,
        startval: startval
      }

      var jsonEditorForm = document.querySelector('#json-editor-form')
      var jsonEditorValue = document.querySelector('#json-editor-value')
      var jsoneditor = new window.JSONEditor(jsonEditorForm, defaultOptions)

      // -------------------------------------------------------------- chart.js

      var ctx = document.getElementById('myChart').getContext('2d')
      var myChart = null

      var startMyChart = function () {
        if (myChart) {
          myChart.destroy()
        }
        myChart = new Chart(ctx, JSON.parse(JSON.stringify(jsoneditor.getValue())))
      }

      jsoneditor.on('ready', function () {
        startMyChart()
        jsonEditorValue.value = JSON.stringify(jsoneditor.getValue(), null, 2)
      })

      jsoneditor.on('change', function () {
        startMyChart()
        jsonEditorValue.value = JSON.stringify(jsoneditor.getValue(), null, 2)
      })
    })
</script>
</body>
</html>
