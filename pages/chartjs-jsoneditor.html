<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chart.js + JSONEditor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-xs-12 col-md-8">
            <div id="json-editor-form"></div>
            <div class="form-group">
                <label for="json-editor-value">JSON Editor Value</label>
                <textarea class="form-control rounded-0" id="json-editor-value" rows="25"></textarea>
            </div>
        </div>
        <div class="col-xs-12 col-md-4">
            <canvas id="myChart" width="400" height="400"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.1.1/chart.js" integrity="sha512-aWx9jeVTj8X49UzUnUHGIlo6rNne1xNsCny/lL0QwUTQK2eilrHXpSk9xbRm4FJ4eLi2XBmnFlRkWPoChSx8bA==" crossorigin="anonymous"></script>
<script>
    window.addEventListener('load', function () {

      // ----------------------------------------------------------- json-editor

      // recommendations
      // bar: (single dataset) (single or multiple background),
      // bar: (multiple dataset) (single background),
      // line: (single and same border/background color)
      // polar area, doughnut & pie : (single dataset with multiple background colors)
      // radar: transparency backgrounds,
      // bubble
      // scatter

      // single color: bars radar, and lines
      // multiple colors: donut and pie

      // single dataset: polar area
      // multiple dataset: polar area

      var startval = {
        type: 'bar',
        data: {
          labels: ['React', 'Angular', 'Vue'],
          datasets: [
            {
              label: '2020',
              data: [125850, 143122, 138825],
              // backgroundColor: ["rgba(0, 40, 240, 0.3)", "rgba(255, 0, 0, 0.3)", "rgba(63, 0.357, 78, 0.3)"],
              backgroundColor: "rgba(0, 40, 240, 0.1)",
              borderColor: 'rgba(0, 40, 240, 1)',
              color: 'rgba(0, 0, 0, 0.3)',
              borderWidth: 1
            },
            {
              label: '2021',
              data: [135850, 132212, 148825],
              // backgroundColor: ["rgba(18,101,135,1)", "rgba(21,149,117,1)", "rgba(53,69,101,1)"],
              backgroundColor: "rgba(255, 0, 0, 0.1)",
              borderColor: "rgba(255, 0, 0, 1)",
              color: 'rgba(0, 0, 0, 0.3)',
              borderWidth: 1
            }
          ]
        }
      }

      var defaultSchema = {
        'title': 'ChartJs',
        'type': 'object',
        'compact': true,
        'properties': {
          'type': {
            'type': 'string',
            'title': 'Chart type',
            'default': 'bar',
            'enum': [
              'bar',
              'line',
              // 'bubble',
              'doughnut',
              'pie',
              'polarArea',
              'radar',
              // 'scatter'
            ],
            'options': {
              'enum_titles': [
                'Bar',
                'Line',
                // 'Bubble',
                'Doughnut',
                'Pie',
                'PolarArea',
                'Radar',
                // 'Scatter'
              ]
            }
          },
          'data': {
            'title': 'Data',
            'type': 'object',
            'properties': {
              'labels': {
                'type': 'array',
                'title': 'Labels',
                'format': 'table',
                'items': {
                  'type': 'string',
                  'title': 'Labels',
                }
              },
              'datasets': {
                'type': 'array',
                'format': 'tabs',
                'title': 'Datasets',
                'items': {
                  'type': 'object',
                  'headerTemplate': '{{ self.label }}',
                  'properties': {
                    'label': {
                      'type': 'string',
                      'title': 'Dataset label',
                      'default': 'My dataset label',
                    },
                    'data': {
                      'type': 'array',
                      'format': 'table',
                      'title': 'Dataset Data',
                      'items': {
                        'type': 'integer',
                        'title': 'Values'
                      }
                    },
                    'backgroundColor': {
                      'title': 'Background',
                      "anyOf":[
                        {
                          "$ref":"#/definitions/singleColor",
                        },
                        {
                          "$ref":"#/definitions/singleColorPicker",
                        },
                        {
                          "$ref":"#/definitions/multipleColor",
                        },
                        {
                          "$ref":"#/definitions/multipleColorPicker",
                        }
                      ]
                    },
                    'borderColor': {
                      "title": "Border Color",
                      "anyOf":[
                        {
                          "$ref":"#/definitions/singleColor",
                        },
                        {
                          "$ref":"#/definitions/singleColorPicker",
                        },
                        {
                          "$ref":"#/definitions/multipleColor",
                        },
                        {
                          "$ref":"#/definitions/multipleColorPicker",
                        }
                      ]
                    },
                    'color': {
                      "title": "Font Color",
                      "anyOf":[
                        {
                          "$ref":"#/definitions/singleColor",
                        },
                        {
                          "$ref":"#/definitions/singleColorPicker",
                        }
                      ]
                    },
                    'borderWidth': {
                      'type': 'number',
                      'title': 'Border With',
                      'default': 1
                    }
                  }
                }
              }
            }
          }
        },
        "definitions": {
          "singleColor": {
            'type': 'string',
            'title': 'Single color',
            'description': 'Background color in Hexadecimal, RGB, or HSL',
          },
          "multipleColor": {
            'type': 'array',
            'title': 'Multiple color',
            'format': 'table',
            'items': {
              'type': 'string',
              'title': 'Background color',
              'description': 'Background color in Hexadecimal, RGB, or HSL',
            }
          },
          "singleColorPicker": {
            'type': 'string',
            'title': 'Single color picker',
            'format': 'color',
            'description': 'Background color in Hexadecimal, RGB, or HSL',
          },
          "multipleColorPicker": {
            'type': 'array',
            'title': 'Multiple color pickers',
            'format': 'table',
            'items': {
              'type': 'string',
              'title': 'Background color',
              'format': 'color',
              'description': 'Background color in Hexadecimal, RGB, or HSL',
            }
          }
        }
      }

      var defaultOptions = {
        iconlib: 'fontawesome5',
        object_layout: 'normal',
        schema: defaultSchema,
        show_errors: 'interaction',
        theme: 'bootstrap4',
        required_by_default: true,
        disable_collapse: true,
        disable_edit_json: true,
        disable_properties: true,
        remove_button_labels: true,
        startval: startval
      }

      var jsonEditorForm = document.querySelector('#json-editor-form')
      var jsonEditorValue = document.querySelector('#json-editor-value')
      var jsoneditor = new window.JSONEditor(jsonEditorForm, defaultOptions)

      // -------------------------------------------------------------- chart.js

      var ctx = document.getElementById('myChart').getContext('2d')
      var myChart = null

      var startMyChart = function () {
        if (myChart) {
          myChart.destroy()
        }
        myChart = new Chart(ctx, JSON.parse(JSON.stringify(jsoneditor.getValue())))
      }

      jsoneditor.on('ready', function () {
        startMyChart()
        jsonEditorValue.value = JSON.stringify(jsoneditor.getValue(), null, 2)
      })

      jsoneditor.on('change', function () {
        startMyChart()
        jsonEditorValue.value = JSON.stringify(jsoneditor.getValue(), null, 2)
      })
    })
</script>
</body>
</html>
